<div class="modal-header bg-info text-white">
  <h5 class="modal-title d-flex align-items-center">
    <i class="icon-file-text2 mr-2"></i>
    <span>Template Details: {{viewedTemplate.name}}</span>
  </h5>
  <button type="button" class="close text-white" ng-click="closeViewModal()" aria-label="Close">
    <span aria-hidden="true">Ã—</span>
  </button>
</div>

<div class="modal-body" ng-if="viewedTemplate" style="max-height: 70vh; overflow-y: auto;">
  <!-- Basic Information Card -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <h6 class="mb-0 font-weight-semibold">
        <i class="icon-info3 mr-2"></i>Basic Information
      </h6>
      <span class="badge" ng-class="{'badge-success': viewedTemplate.isActive, 'badge-secondary': !viewedTemplate.isActive}">
        {{viewedTemplate.isActive ? 'Active' : 'Inactive'}}
      </span>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="detail-item mb-3">
            <label class="detail-label">Template Code</label>
            <div class="detail-value">
              <span class="badge badge-light">{{viewedTemplate.code}}</span>
            </div>
          </div>

          <div class="detail-item mb-3">
            <label class="detail-label">Category</label>
            <div class="detail-value">
              <i class="icon-tag mr-1 text-muted"></i>
              {{getCategoryLabel(viewedTemplate.category)}}
            </div>
          </div>

          <div class="detail-item">
            <label class="detail-label">Created</label>
            <div class="detail-value">
              <i class="icon-calendar2 mr-1 text-muted"></i>
              {{viewedTemplate.createdAt | date:'mediumDate'}}
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="detail-item mb-3">
            <label class="detail-label">Periodicity</label>
            <div class="detail-value">
              <i class="icon-clock mr-1 text-muted"></i>
              {{getPeriodicityLabel(viewedTemplate.periodicity)}}
            </div>
          </div>

          <div class="detail-item mb-3">
            <label class="detail-label">Last Updated</label>
            <div class="detail-value">
              <i class="icon-history mr-1 text-muted"></i>
              {{viewedTemplate.updatedAt | date:'mediumDate'}}
            </div>
          </div>
        </div>
      </div>

      <div class="detail-item" ng-if="viewedTemplate.description">
        <label class="detail-label">Description</label>
        <div class="detail-value">
          <div class="border rounded p-3 bg-light">
            {{viewedTemplate.description}}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Calculation Configuration Card -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-light">
      <h6 class="mb-0 font-weight-semibold">
        <i class="icon-calculator mr-2"></i>Calculation Configuration
      </h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="detail-item mb-3">
            <label class="detail-label">Formula Type</label>
            <div class="detail-value">
              {{getFormulaTypeLabel(viewedTemplate.calculationConfig.formulaType)}}
            </div>
          </div>

          <div class="detail-item mb-3">
            <label class="detail-label">Default Share Amount</label>
            <div class="detail-value">
              <span class="font-weight-semibold text-primary">
                {{viewedTemplate.calculationConfig.defaultShareAmount | currency}}
              </span>
            </div>
          </div>
        </div>

        <div class="col-md-6" ng-if="viewedTemplate.calculationConfig.formula">
          <div class="detail-item">
            <label class="detail-label">Formula</label>
            <div class="detail-value">
              <div class="border rounded p-2 bg-light">
                <code>{{viewedTemplate.calculationConfig.formula}}</code>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Parts Configuration -->
      <div ng-if="viewedTemplate.calculationConfig.partsConfig">
        <hr class="my-4">

        <h6 class="font-weight-semibold mb-3">
          <i class="icon-puzzle3 mr-1"></i>Parts Configuration
        </h6>

        <div class="row mb-3">
          <div class="col-md-6">
            <div class="detail-item">
              <label class="detail-label">Default Parts</label>
              <div class="detail-value">
                {{viewedTemplate.calculationConfig.partsConfig.defaultParts}}
              </div>
            </div>
          </div>
        </div>

        <!-- Parts Rules Table -->
        <div ng-if="viewedTemplate.calculationConfig.partsConfig.partRules.length > 0">
          <div class="table-responsive">
            <table class="table table-sm table-bordered table-hover">
              <thead class="thead-light">
              <tr>
                <th width="70%">Condition</th>
                <th width="30%">Parts</th>
              </tr>
              </thead>
              <tbody>
              <tr ng-repeat="rule in viewedTemplate.calculationConfig.partsConfig.partRules">
                <td>
                  <div class="d-flex align-items-center">
                    <span class="badge badge-light mr-2">#{{$index + 1}}</span>
                    <span>{{rule.condition}}</span>
                  </div>
                </td>
                <td class="font-weight-semibold">{{rule.parts}}</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Eligibility Rules Card -->
  <div class="card border-0 shadow-sm mb-4" ng-if="viewedTemplate.eligibilityRules.length > 0">
    <div class="card-header bg-light">
      <h6 class="mb-0 font-weight-semibold">
        <i class="icon-shield-check mr-2"></i>Eligibility Rules
      </h6>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-sm table-bordered table-hover mb-0">
          <thead class="thead-light">
          <tr>
            <th width="25%">Field</th>
            <th width="15%">Operator</th>
            <th width="25%">Value</th>
            <th width="35%">Description</th>
          </tr>
          </thead>
          <tbody>
          <tr ng-repeat="rule in viewedTemplate.eligibilityRules">
            <td>
              <div class="d-flex align-items-center">
                <span class="badge badge-light mr-2">#{{$index + 1}}</span>
                <span>{{rule.field}}</span>
              </div>
            </td>
            <td>{{rule.operator}}</td>
            <td>{{rule.value}}</td>
            <td class="text-muted">{{rule.description || 'N/A'}}</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Approval Workflow Card -->
  <div class="card border-0 shadow-sm" ng-if="viewedTemplate.approvalWorkflow.steps.length > 0">
    <div class="card-header bg-light">
      <h6 class="mb-0 font-weight-semibold">
        <i class="icon-flow-tree mr-2"></i>Approval Workflow
      </h6>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-sm table-bordered table-hover mb-0">
          <thead class="thead-light">
          <tr>
            <th width="10%">Step</th>
            <th width="30%">Role</th>
            <th width="20%">Type</th>
            <th width="40%">Description</th>
          </tr>
          </thead>
          <tbody>
          <tr ng-repeat="step in viewedTemplate.approvalWorkflow.steps">
            <td class="font-weight-semibold">{{$index + 1}}</td>
            <td>{{step.role}}</td>
            <td>{{step.approvalType}}</td>
            <td class="text-muted">{{step.description || 'N/A'}}</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal-footer bg-light">
  <button type="button" class="btn btn-light" ng-click="closeViewModal()">
    <i class="icon-cross2 mr-1"></i>Close
  </button>
  <button type="button" class="btn btn-primary" ng-click="editTemplate(viewedTemplate)">
    <i class="icon-pencil7 mr-1"></i>Edit Template
  </button>
</div>

<style>
  .detail-label {
    font-weight: 500;
    color: #6c757d;
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
  }

  .detail-value {
    font-size: 1rem;
    padding-left: 0.5rem;
  }

  .modal-body {
    scrollbar-width: thin;
  }

  .modal-body::-webkit-scrollbar {
    width: 8px;
  }

  .modal-body::-webkit-scrollbar-thumb {
    background-color: #dee2e6;
    border-radius: 4px;
  }
</style>