<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; font-size: 12px; }
        h1 { color: #2c3e50; font-size: 18px; }
        h2 { color: #34495e; font-size: 14px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .logo { max-height: 60px; }
        .summary-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .summary-table th, .summary-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .summary-table th { background-color: #f2f2f2; }
        .allocations-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 10px; }
        .allocations-table th, .allocations-table td { border: 1px solid #ddd; padding: 5px; text-align: left; }
        .allocations-table th { background-color: #f2f2f2; }
        .footer { margin-top: 30px; font-size: 10px; color: #7f8c8d; text-align: center; }
        .page-break { page-break-after: always; }
    </style>
</head>
<body>
<div class="header">
    <div>
        <h1>Bonus Export Report</h1>
        <p>Generated on: <%= generatedAt %></p>
    </div>
    <% if (logo) { %>
        <img class="logo" src="<%= logo %>" alt="Company Logo">
    <% } %>
</div>

<h2>Summary</h2>
<table class="summary-table">
    <tr>
        <th>Reference Period</th>
        <td><%= instance.referencePeriod %></td>
    </tr>
    <tr>
        <th>Bonus Template</th>
        <td><%= instance.templateId.name %> (<%= instance.templateId.code %>)</td>
    </tr>
    <tr>
        <th>Status</th>
        <td><%= instance.status %></td>
    </tr>
    <tr>
        <th>Total Amount</th>
        <td><%= totalAmount.toLocaleString() %> XAF</td>
    </tr>
    <tr>
        <th>Allocations Count</th>
        <td><%= allocations.length %></td>
    </tr>
</table>

<h2>Allocations</h2>
<table class="allocations-table">
    <thead>
    <tr>
        <th>Personnel ID</th>
        <th>Name</th>
        <th>Grade</th>
        <th>Category</th>
        <th>Base Salary</th>
        <th>Parts</th>
        <th>Amount</th>
        <th>Status</th>
    </tr>
    </thead>
    <tbody>
    <% allocations.forEach(alloc => { %>
        <tr>
            <td><%= alloc.personnelId.identifier %></td>
            <td><%= alloc.personnelId.name.text %></td>
            <td><%= alloc.personnelSnapshotId?.data?.grade || 'N/A' %></td>
            <td><%= alloc.personnelSnapshotId?.data?.category || 'N/A' %></td>
            <td><%= (alloc.calculationInputs?.baseSalary || 0).toLocaleString() %></td>
            <td><%= alloc.calculationInputs?.parts || 1 %></td>
            <td><%= (alloc.finalAmount || 0).toLocaleString() %></td>
            <td><%= alloc.status %></td>
        </tr>
    <% }); %>
    </tbody>
</table>

<div class="footer">
    <p>This document was automatically generated by the HR System</p>
</div>
</body>
</html>