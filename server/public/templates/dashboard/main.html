<div class="dashboard-container" layout="column" flex>
    <!-- Dashboard Header -->
    <div class="dashboard-header" layout="row" layout-align="space-between center">
        <div>
            <h1 class="dashboard-title" translate>Dashboard</h1>
            <p class="dashboard-subtitle" translate>Personnel and system overview</p>
        </div>
        <div class="dashboard-actions">
            <md-button class="md-icon-button" ng-click="loadDashboard()">
                <md-icon>refresh</md-icon>
                <md-tooltip translate>Refresh dashboard</md-tooltip>
            </md-button>
            <md-button class="md-icon-button" ng-click="showFilterDialog()">
                <md-icon>filter_list</md-icon>
                <md-tooltip translate>Filter options</md-tooltip>
            </md-button>
        </div>
    </div>
    
    <!-- Personnel Search Widget -->
    <md-card class="dashboard-widget search-widget" ng-if="widgets.personnelSearch.enabled">
        <md-card-header>
            <md-card-header-text>
                <span class="md-title" translate>Personnel Search</span>
            </md-card-header-text>
        </md-card-header>
        <md-card-content>
            <md-autocomplete
                md-search-text="personnelSearchText"
                md-selected-item-change="selectPersonnel(item)"
                md-items="item in personnelQuerySearch(personnelSearchText)"
                md-item-text="item.fname"
                md-min-length="2"
                placeholder="{{'Search personnel...' | translate}}"
                md-no-cache="true"
                flex>
                <md-item-template>
                    <div class="personnel-search-result">
                        <div class="result-avatar" ng-style="{'background-color': item.gender === 'M' ? '#E3F2FD' : '#FCE4EC'}">
                            {{item.fname.charAt(0)}}
                        </div>
                        <div class="result-info">
                            <div class="result-name">{{item.fname}}</div>
                            <div class="result-details">{{item.identifier}} - {{item.affectedTo.position.name}}</div>
                        </div>
                    </div>
                </md-item-template>
            </md-autocomplete>
        </md-card-content>
    </md-card>
    
    <!-- Stats Cards Row -->
    <div class="stats-row" layout="row" layout-wrap>
        <div flex="33" flex-xs="100">
            <stats-widget
                title="{{'Total Personnel' | translate}}"
                value="stats.totalPersonnel"
                subtitle="{{'Active employees' | translate}}"
                icon="people"
                color="primary"
                loading="widgets.personnelStats.loading">
            </stats-widget>
        </div>
        <div flex="33" flex-xs="100">
            <stats-widget
                title="{{'Active Personnel' | translate}}"
                value="stats.activePersonnel"
                subtitle="{{'Currently working' | translate}}"
                icon="person"
                color="success"
                loading="widgets.personnelStats.loading">
            </stats-widget>
        </div>
        <div flex="33" flex-xs="100">
            <stats-widget
                title="{{'Structures' | translate}}"
                value="stats.byStructure.length"
                subtitle="{{'Organizational units' | translate}}"
                icon="account_tree"
                color="info"
                loading="widgets.personnelStats.loading">
            </stats-widget>
        </div>
    </div>
    
    <!-- Charts Row -->
    <div class="charts-row" layout="row" layout-wrap>
        <div flex="50" flex-xs="100">
            <md-card class="dashboard-widget chart-widget">
                <md-card-header>
                    <md-card-header-text>
                        <span class="md-title" translate>Personnel by Gender</span>
                    </md-card-header-text>
                    <md-button class="md-icon-button" ng-click="exportChart('gender-chart', 'Personnel by Gender')">
                        <md-icon>file_download</md-icon>
                        <md-tooltip translate>Export chart</md-tooltip>
                    </md-button>
                </md-card-header>
                <md-card-content>
                    <personnel-chart
                        chart-type="doughnut"
                        chart-id="gender-chart"
                        data="chartData.genderChart"
                        loading="widgets.chartPersonnelByGender.loading">
                    </personnel-chart>
                </md-card-content>
            </md-card>
        </div>
        <div flex="50" flex-xs="100">
            <md-card class="dashboard-widget chart-widget">
                <md-card-header>
                    <md-card-header-text>
                        <span class="md-title" translate>Personnel by Structure</span>
                    </md-card-header-text>
                    <md-button class="md-icon-button" ng-click="exportChart('structure-chart', 'Personnel by Structure')">
                        <md-icon>file_download</md-icon>
                        <md-tooltip translate>Export chart</md-tooltip>
                    </md-button>
                </md-card-header>
                <md-card-content>
                    <personnel-chart
                        chart-type="bar"
                        chart-id="structure-chart"
                        data="chartData.structureChart"
                        loading="widgets.chartPersonnelByStructure.loading">
                    </personnel-chart>
                </md-card-content>
            </md-card>
        </div>
    </div>
    
    <!-- Recent Activity Widget -->
    <md-card class="dashboard-widget activity-widget" ng-if="widgets.recentActivity.enabled">
        <md-card-header>
            <md-card-header-text>
                <span class="md-title" translate>Recent Activity</span>
            </md-card-header-text>
        </md-card-header>
        <md-card-content>
            <div class="loading-overlay" ng-if="widgets.recentActivity.loading">
                <md-progress-circular md-mode="indeterminate" md-diameter="50"></md-progress-circular>
            </div>
            <md-list class="activity-list">
                <md-list-item ng-repeat="activity in stats.recentChanges | limitTo:5">
                    <md-icon>{{activity.icon}}</md-icon>
                    <div class="md-list-item-text">
                        <h3>{{activity.title}}</h3>
                        <p>{{activity.description}} - {{activity.date | date:'short'}}</p>
                    </div>
                </md-list-item>
                <md-list-item ng-if="stats.recentChanges.length === 0 && !widgets.recentActivity.loading">
                    <md-icon>info</md-icon>
                    <div class="md-list-item-text">
                        <h3 translate>No recent activity</h3>
                        <p translate>There is no recent activity to display</p>
                    </div>
                </md-list-item>
            </md-list>
        </md-card-content>
    </md-card>
</div>
